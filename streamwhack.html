<style>
body {
	background-color: black;
	}

table {
	width:100%;
	border-collapse: collapse;
	border: 1px solid black;
}
td {
	width:100px;
	height: 300px;
	text-align: left;
	font-size: 200%;
	background-color: black;
	color: greenyellow;
	font-family: "Lucida Console", "Courier New", monospace;
}
td a {
	display:block;
}
</style>

<table border=1>
<tr>
	<td id="game_id" class="trigger">
		Get Game
</tr>
</table>


<script src="config.js"></script>

<script>

function game_lookup(ele, game_id){
	var xhttp = new XMLHttpRequest();

	//this is hardcoded to just use the Twitch game lookup endpoint. Add other endpoints to do other things
	xhttp.open('GET','https://api.twitch.tv/helix/games?id=' + game_id , true);
	xhttp.setRequestHeader("client-id", config.client_id)
	xhttp.setRequestHeader("Authorization", config.user_auth)
	xhttp.send();

	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			var resp = JSON.parse(this.responseText);
			payload = resp.data[0]
			sized_box_art_url = payload.box_art_url.replace('{width}','200').replace('{height}','300')
			console.log("Success: " + payload.name)
			
			ele.innerHTML =	"Now Playing:<br>" + payload.name;
			
			ele.style.backgroundColor='black'
		}
	};
}

function myFunction(ele) {
	var xhttp = new XMLHttpRequest();

	//this is hardcoded to just use the Twitch channel info endpoint. Add other endpoints to do other things
	xhttp.open('GET','https://api.twitch.tv/helix/search/channels?query=' + config.user, true);
	xhttp.setRequestHeader("client-id", config.client_id)
	xhttp.setRequestHeader("Authorization", config.user_auth)
	xhttp.send();

	xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
			var resp = JSON.parse(this.responseText);
			if (ele.id == 'game_id'){
				game_lookup(ele, resp.data[0][ele.id]);
			} else {
				ele.innerHTML =	resp.data[0][ele.id];
			
				ele.style.backgroundColor='black'
			}
	   } else {
			ele.style.backgroundColor='gray'
	   }
    };

	
}

var elems = document.getElementsByClassName('trigger');
for(var i = 0; i < elems.length; i++) {
	elems[i].onclick = function() {myFunction(this)};
	elems[i].onmousedown = function(){this.style.backgroundColor='white'};
}


</script>